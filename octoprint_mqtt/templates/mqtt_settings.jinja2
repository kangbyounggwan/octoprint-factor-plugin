<!-- settings_plugin_factor_mqtt 의 컨텐츠만 넣어야 합니다. tab-pane 같은 래퍼 금지 -->
<div id="settings_plugin_factor_mqtt" class="factor-mqtt">
  <div class="row">
    <div class="col-xs-12 col-md-6">
      <h4>MQTT 브로커 설정</h4>

      <div class="form-group">
        <label for="mqtt_broker_host">브로커 호스트</label>
        <input type="text" class="form-control" id="mqtt_broker_host"
               data-bind="value: brokerHost" placeholder="localhost">
        <p class="help-block">MQTT 브로커의 호스트명 또는 IP.</p>
      </div>

      <div class="form-group">
        <label for="mqtt_broker_port">브로커 포트</label>
        <input type="number" class="form-control" id="mqtt_broker_port"
               data-bind="value: brokerPort" min="1" max="65535" placeholder="1883">
        <p class="help-block">기본값: 1883</p>
      </div>

      <div class="form-group">
        <label for="mqtt_broker_username">사용자명 (선택)</label>
        <input type="text" class="form-control" id="mqtt_broker_username"
               data-bind="value: brokerUsername" placeholder="username">
      </div>

      <div class="form-group">
        <label for="mqtt_broker_password">비밀번호 (선택)</label>
        <input type="password" class="form-control" id="mqtt_broker_password"
               data-bind="value: brokerPassword" placeholder="password">
      </div>

      <div class="form-group">
        <label for="mqtt_topic_prefix">토픽 접두사</label>
        <input type="text" class="form-control" id="mqtt_topic_prefix"
               data-bind="value: topicPrefix" placeholder="octoprint">
        <p class="help-block">모든 발행 토픽 앞에 붙는 접두사.</p>
      </div>
    </div>

    <div class="col-xs-12 col-md-6">
      <h4>발행 설정</h4>

      <div class="form-group">
        <label for="mqtt_qos_level">QoS 레벨</label>
        <select class="form-control" id="mqtt_qos_level" data-bind="value: qosLevel">
          <option value="0">0 - 최대 한 번</option>
          <option value="1">1 - 최소 한 번</option>
          <option value="2">2 - 정확히 한 번</option>
        </select>
        <p class="help-block">메시지 전달 보장 수준을 선택하세요.</p>
      </div>

      <div class="checkbox">
        <label>
          <input type="checkbox" data-bind="checked: retainMessages">
          메시지 유지(Retain)
        </label>
      </div>

       <h5>발행할 이벤트</h5>
       <div class="checkbox"><label><input type="checkbox" data-bind="checked: publishStatus"> 프린터 상태 변경</label></div>
       <div class="checkbox"><label><input type="checkbox" data-bind="checked: publishProgress"> 인쇄 진행률</label></div>
       <div class="checkbox"><label><input type="checkbox" data-bind="checked: publishTemperature"> 온도 정보</label></div>
       <div class="checkbox"><label><input type="checkbox" data-bind="checked: publishGcode"> G-code 명령</label></div>
       <div class="checkbox"><label><input type="checkbox" data-bind="checked: publishSnapshot"> 스냅샷 전송</label></div>
       
       <div class="form-group" data-bind="visible: publishSnapshot">
         <label for="periodic_interval">스냅샷 전송 간격 (초)</label>
         <input type="number" class="form-control" id="periodic_interval" 
                data-bind="value: periodicInterval" min="0.1" max="60" step="0.1" placeholder="1.0">
         <p class="help-block">스냅샷을 전송할 간격을 설정하세요 (기본값: 1.0초)</p>
       </div>
    </div>
  </div>

  <hr/>

  <h4>연결 상태</h4>
  <div id="mqtt_connection_status" class="alert alert-info"
       data-bind="text: connectionStatus">MQTT 연결 상태를 확인하는 중...</div>

  <button type="button" class="btn btn-primary" data-bind="click: testConnection">
    <span class="glyphicon glyphicon-refresh"></span> 연결 테스트
  </button>

  <hr/>

  <h4>프린터 정보</h4>
  <div class="form-group">
    <label>펌웨어 정보(M115)</label>
    <pre style="white-space:pre-wrap;word-break:break-all;margin:0;"
         data-bind="text: firmwareInfo">미수집</pre>
    <div style="margin-top:6px;">
      <button type="button" class="btn btn-default btn-sm"
              data-bind="click: refreshFirmware">
        새로고침
      </button>
    </div>
    <p class="help-block">프린터에서 최근 수신된 M115 응답 라인을 표시합니다.</p>
  </div>
</div>
